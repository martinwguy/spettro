<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<TITLE>Spettro manual</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</HEAD>
<BODY>
<H1 ALIGN=CENTER>SPETTRO</H1>
<P ALIGN=CENTER>Visualize music as it plays</P>
<HR>
<IMG SRC="screenshot.png" ALIGN=RIGHT>
Spettro plays a sound file and displays a scrolling
spectrogram as it plays.
<P>
"Normal" spectrograms have a linear frequency axis,
which means that the top half of the graphic represents the
top octave of the sound, the next octave down occupies
the next quarter of the screen, the following one the next eighth and so on,
leaving most of the musical information crushed into the bottom few lines
of the graphic.
<P>
Spettro is different. Having a logarithmic frequency axis, every
octave is the same height, like a conventional musical score, revealing
far more musically-interesting detail.

<H2>Keyboard commands</H2>

<H3>Keys to position the graphic</H3>
<DL>
 <DT>Space
  <DD>The space bar makes spettro play the file, scrolling the graphic
      leftwards in time with the audio. Press it again and it pauses,
      press it again and it continues playing. WHen it gets to the end
      of the piece, it stops automatically; pressing Space again makes it
      start playing again from the beginning.<BR>
      If spettro was built to use the Enlightenment toolkit instead of SDL,
      the Play/Pause media button has the same effect
      and the Stop media button pauses playing.
 <DT>&larr; &rarr;
  <DD>Left arrow skips back one tenth of a screenful in the audio file.
      If a Shift key was held down, it skips back a whole screenful, and
      holding down Control scrolls by one pixel; with both, by one second.
  <BR>Right arrow works similarly but skips forward in time instead of back.
 <DT>Home End
  <DD>Home moves you to the start of the piece, End to the end.<BR>
      If spettro was built to use the Enlightenment toolkit instead of SDL,
      the |<< ad >>| keys also do these.
 <DT>&uarr; &darr;
  <DD>The Up Arrow key moves you up the frequency axis by a tenth of the height
      of the spectrogram; similarly, Down Arrow pans down to reveal more of the
      lower frequencies. With Shift, the view pans by exactly one screenful;
      with Ctrl, by one pixel.
 <DT>PgUp PgDown
  <DD>Moves up/down the frequency axis by the height of the graph
      (the same as Shift-Up and Shift-Down).
 <DT>x X
  <DD>Pressing a lower case 'x' zooms out by a factor of two on the time
      axis, so that twice as much of the audio becomes visible;
      Shift-'X' zooms in, enlarging the central half of the display to fit
      the whole window.
 <DT>y Y
  <DD>Similarly, 'y' zooms out on the frequency axis,
      showing twice the frequency range as before and compressing
      the graphic in the vertical direction; 'Y' zooms in by a factor of
      two so that what was the central half of the graphic now fills the
      whole height.
 <DT>+ -
  <DD>Either of the Plus keys zooms in on both axes, like X and Y
      simultaneously, and the Minus keys zoom out in both directions.
</DL>

<H3>Brightness, contrast and image quality</H3>

<DL>
 <DT>c
  <DD>Cycle through alternate color maps: sox, sndfile-spectrogram,
      gray (white on black), print (grayscale, black on white).
      You can also select an initial color map with the <B>-c<b> option.
 <DT>* /
  <DD>Star and slash adjust the dynamic range of the color values and act
      like a contrast control.
      The Star key increases the dynamic range by 6dB
      brightening the darker areas to reveal detail,
      and the Slash key decreases the dynamic range by 6dB,
      darkening the graphic to hide noise and make the main events stand out.
      <BR>
      The loudest moments in any piece are always shown at maximum brightness
      (white) and by changing the dynamic range, you change which sound energy
      value is represented by the dimmest color.
 <DT>f F
  <DD>These keys change the FFT size to improve vertical or horizontal focus.
      'f' halves it, improving time resolution, and 'F' doubles it, improving
      frequency resolution.
      <BR>
      The FFT size determines the length of the audio sample used to
      create each column of pixels.
      The starting value is 1/5th of a second, which resolves frequencies
      with a resolution of 5Hz and clearly shows about five distinct
      musical events per second.
      <BR>
      Larger values resolve frequencies more finely but time more coarsely,
      improving the vertical "focus" but smearing it horizontally,
      while smaller values give crisper time definition at the price of
      fuzzier frequency definition.
      <BR>You can also set the initial FFT frequency with the <B>-f</B> flag.
 <DT>R K H N
  <DD>These keys, when pressed with Shift, select a Rectangular, Kaiser,
      Hann or Nuttall window as the pre-FFT convolution function.
      There is a corresponding command-line option <B>-W</B>.
 <DT>t
  <DD>The 't' key show the current playing time on stdout.
 <DT>Ctrl-L
  <DD>Control-L redraws the display from the FFT result cache.
 <DT>Ctrl-R
  <DD>Control-R redraws the display, first throwing away all cached FFT results
      so it is recalculated from the audio data.
</DL>

<H3>Frequency markers</H3>

Spettro can overlay the graphic with various sets of horizontal lines:
piano keys, staff lines and guitar strings.

<DL>
 <DT>k
  <DD>The 'k' key (or the <B>-k</B> command-line flag)
      overlays the spectrogram with 88 horizontal lines,
      some black, some white, showing the frequencies of the keys
      of a grand piano from A0(27.5Hz) to C8(4186Hz).
      <BR>Pressing 'k' again removes the keyboard overlay.
 <DT>s
  <DD>The 's' key (or the <B>-s</B> command-line flag)
      overlays two five-line pentagrams, as used in
      manuscript, making it look more like a conventional musical score.
      <BR>From top to bottom, the score lines are centered at:
      <BR>F5(698.5Hz) D5(587.3Hz) B4(493.9Hz) G4(392.0Hz) E4(329.6Hz)
      <BR>A3(220.0Hz) F3(174.6Hz) D3(146.8Hz) B2(123.5Hz) G2(98.0Hz)
      <BR>Pressing 's' again removes the score lines.
 <DT>g
  <DD>The 'g' key (or the <B>-g</B> command-line flag)
      overlays the frequencies of the six strings
      of the classical guitar, centered at:
      <BR>E2(82.4Hz) A2(110Hz) D3(146.8Hz) G3(196.0Hz) B3(246.9Hz) E4 (329.6Hz)
      <BR>Pressing 'g' again removes them.
 <DT>a
  <DD>The 'a' key toggles a frequency axis on the left side of the graph.
</DL>
While piano key lines are one pixel thick, staff lines and guitar lines
are both three pixels thick.
<P>
Only one of Staff and Guitar lines displays at a time (because they overlap)
but you can display the piano keys together with either of them
to identify notes above the top score line or to see the fretted
positions of the guitar strings.

<H3>Bar line indicators</H3>

To help you pick out the rhythm, you can overlay evenly-spaced vertical white
lines on the graphic to show where each bar (or beat) begins.
<P>
To do this, you mark two pixel columns to say where some bar
starts and ends.
When you set the first of the two bar line markers, a single vertical
line appears at that position you marked and when you set the other one,
bar lines appear at that position and evenly throughout the piece.
<P>
There are three ways to mark the bar line positions:
<UL>
 <LI>The command-line flags <B>-l</B> and <B>-r</B> set the left and right
     bar line position, measured in seconds from the start of the piece.
 <LI>You can position the graphic so that the green line is at the start of a
     bar, press 'l' or '[', move it to the end of the bar and press 'r' or ']'.
     For more precise positioning, zoom in on the time axis with 'X' and use
     Control-Leftarrow and Control-Rightarrow to shift the graphic by one pixel
     at a time.
 <LI>If you hold down Control, you can position the left bar line by clicking
     the left mouse button and the right bar line by clicking the right button.
</UL>
You can also set the "left" marker to the right of the "right" marker
and it still works.

you position the graphic so that the central green line
is at the start of one bar, and press '[', then move right until the
green line is at the start of the following bar and press ']'. Evenly-spaced
bar lines will appear throughout the piece.
<BR>To position the bar lines precisely in time with the music,
you can zoom in on the start of a bar using 'X', then hold down the 'Ctrl' key
and use the Left and Right arrow keys to scroll the graphic by a single pixel.
<DL>
 <DT>l
  <DD>Pressing L positions the left bar line at the green line.
 <DT>r
  <DD>Pressing R positions the right bar line at the green line.
</DL>

<H3>System control</H3>

<DL>
 <DT>Esc Ctrl-C Q
  <DD>These all make spettro quit.
 <DT>Ctrl-R
  <DD>Control R redraws the graphic display from the results already
      computed. This can be necessary if the display becomes garbled due to
      CPU overload, refreshing the display from spettro's internal data.
 <DT>t
  <DD>Prints the current playing time on stdout.
 <DT>9 0
  <DD>Spettro has a soft volume control, like mplayer and VLC, except that
      spettro's has no maximum and it reduces it automatically if it would have
      made the audio output clip.
</DL>

<H2>Startup options</H2>

On spettro's command line you can supply various option flags before the
audio file name:
<DL>
 <DT>-p
  <DD>Start playing the audio file as soon as the program starts up.
 <DT>-t x
  <DD>Fast-forward to time "x" into the audio file, where "x" is a
      floating-point number measured in seconds.
 <DT>-e
  <DD>Exit when the audio file has finished playing.
 <DT>-c <I>which</I>
  <DD>Select an initial color map to use. <I>which</I> can be:
   <DL>
    <DT>heat
     <DD>A colored heat map
    <DT>gray
     <DD>Shades of gray from black up to white
    <DT>print
     <DD>Shades of gray from white up to black
   </DL>
 <DT>-f
  <DD>Set the FFT frequency in Hz. Default: 5 (one fifth of a second.)
 <DT>-y
  <DD>Show a logarithmic frequency scale down the left side of the graph
 <DT>-W[rkhn]
  <DD>Selects the pre-FFT window convolution function as
    <DL>
     <DT>r
       <DD>Rectangular. The sample's edges are not trimmed, resulting in
	floral artifacts in the spectrogram, most easily seen at
	high magnification., Kaiser, Hann or Nuttall.
	It is the fastest of the window functions because it does nothing.
     <DT>k
      <DD>Kaiser window
     <DT>h
      <DD>Hann (a.k.a. "Hanning") window
     <DT>n
      <DD>Nuttall window
    </DL>
    There are corresponding keystroke commands
    <B>R</B>, <B>K</B>, <B>H</B> and <B>N</B>.
    For more info on the functions' peculiarities and merits, see
    <A HREF="http://en.wikipedia.org/wiki/Window_function">http://en.wikipedia.org/wiki/Window_function</A>
    or experiment with spettro and see for yourself :)

 <DT>-h n
  <DD>Set the spectrogram height to n pixels, with default of 480.
 <DT>-w n
  <DD>Set the spectrogram width to n pixels, with default of 640.
 <DT>-F
  <DD>Start in full-screen mode.
      The spectrogram is calculated at the width and height given above,
      then scaled to the size of the screen, so if you want it pixel-per-pixel
      you need to supply the width and height. "xrandr" will tell you these.
 <DT>-j n
  <DD>Set maximum number of threads to use (default: the number of CPUs.)
 <DT>-k
  <DD>Overlay black and white lines showing where 88-note piano keys are.
 <DT>-s
  <DD>Overlay the conventional score notation pentagrams.
 <DT>-g
  <DD>Overlay lines showing the positions of a classical guitar's strings.
 <DT>-v n
  <DD>Set the softvolume level to N (>1.0 is louder, <1.0 is softer)\n\
 <DT>--help
  <DD>Show a summary of all option flags, keys and environment variables.
</DL>
If no filename is supplied, it opens "audio.wav".

<H3>Environment variables</H3>

You can also tune some of spettro's internal parameters by setting environment
variables on the command line, for example
<BLOCKQUOTE>
PPSEC=100&nbsp;&nbsp;spettro"
</BLOCKQUOTE>
<DL>
 <DT>FPS
  <DD>Video frames per second, default 25
 <DT>PPSEC
  <DD>Pixel columns per second, default 25
 <DT>DYN_RANGE
  <DD>Dynamic range of amplitude values in decibels, default=100
 <DT>MIN_FREQ
  <DD>The frequency centered on the bottom pixel row, currently 27.5 (A1)
 <DT>MAX_FREQ
  <DD>The frequency centered on the top pixel row, currently 14080 (A9)
</DL>

<H2>Bugs</H2>
<OL>
<LI>
If you zoom in too much (about five 'Y's) the graphic turns upside down
and zooms out (because min_freq > max_freq... and it still works!)
</OL>

<HR>
Martin Guy <martinwguy&#64;gmail.com>, August 2018.
</BODY>
</HTML>

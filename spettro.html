<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<TITLE>Spettro manual</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</HEAD>
<BODY>
<H1 ALIGN=CENTER>SPETTRO</H1>
<P ALIGN=CENTER>Visualize music as it plays</P>
<HR>
<IMG SRC="screenshot.png" ALIGN=RIGHT>
Spettro plays a sound file and displays a scrolling
spectrogram as it plays.
<P>
"Normal" spectrograms have a linear frequency axis,
which means that the top half of the graphic represents the
top octave of the sound, the next octave down occupies
the next quarter of the screen, the following one the next eighth and so on,
leaving most of the musical information crushed into the bottom few lines
of the graphic.
<P>
Spettro is different. Having a logarithmic frequency axis, every
octave has the same height, like a conventional musical score, revealing
more musically-interesting detail.

<H2>Keyboard commands</H2>

<H3>Keys to position the graphic</H3>
<DL>
 <DT><B>Space</B>
  <DD>The space bar makes spettro play the file, scrolling the graphic
      to the left, in time with the audio. Press it again and it pauses,
      press it again and it continues playing. WHen it gets to the end
      of the piece, it stops automatically; pressing Space again makes it
      start playing again from the beginning.<BR>
      If your version of spettro was built to use the Enlightenment toolkit
      instead of SDL, the Play/Pause media button will have the same effect
      and the Stop media button will pause playing.
 <DT><B>&larr; &rarr;</B>
  <DD>Left arrow skips back one tenth of a screenful in the audio file.
      If a <B>Shift</B> key is held down, it skips back a whole screenful, while
      holding down Control scrolls by one pixel; with both, by one second.
  <BR>Right arrow works similarly but skips forward in time instead of back.
 <DT><B>Home End</B>
  <DD>Home moves you to the start of the piece, End to the end.<BR>
      If spettro was built to use the Enlightenment toolkit instead of SDL,
      the |<< ad >>| keys also do this.
 <DT><B>&uarr; &darr;</B>
  <DD>The Up Arrow key moves you up the frequency axis by a tenth of the height
      of the spectrogram; similarly, Down Arrow pans down to reveal more of the
      lower frequencies. With <B>Shift</B>, the view pans by the height of the graph,
      with <B>Ctrl</B>, by one pixel.
 <DT><B>PgUp PgDown</B>
  <DD>Moves up/down the frequency axis by the height of the graph
      (the same as <B>Shift-Up</B> and <B>Shift-Down</B>).
 <DT><B>x X</B>
  <DD>Pressing a lower case '<B>x</B>' zooms out by a factor of two on the time
      axis, so that twice as much of the audio becomes visible;
      upper case '<B>X</B>' zooms in, enlarging the central half of the display
      to the width of the graph.
      <P>
      If you zoom in enough while playing the audio, spettro will be
      unable to calculate enough FFTs per second to keep the screen updated.
 <DT><B>y Y</B>
  <DD>Similarly, '<B>y</B>' zooms out on the frequency axis,
      showing twice the frequency range as before and compressing
      the graphic in the vertical direction; '<B>Y</B>' zooms in by a factor of
      two so that what was the central half of the graphic now fills the
      whole height. If <B>Ctrl</B> is held down, it zooms out/in by two pixels,
      revealing or hiding one row of pixels at the top and one at the bottom.
      <BR>
      The maximum permitted zoom out is when the frequency at the top of
      the graph is 9 x 10^307 times the one at the bottom
      (half the value of the largest 64-bit floating-point number.)
 <DT><B>+ -</B>
  <DD>Either of the Plus keys zooms in on both axes, like X and Y
      simultaneously, and the Minus keys zoom out in both directions.
</DL>

<H3>Brightness, contrast and image quality</H3>

<DL>
 <DT><B>c</B>
  <DD>Cycle through alternate color maps: a colored heat map (the default),
      gray (white on black), print (grayscale, black on white).
      You can also select an initial color map with the <B>-c</B> option.
 <DT><B>b d</B>
  <DD>The '<B>b</B>' and '<B>d</B>' keys brighten and darken the graphic, like a
      contrast control, by adjusting the range of loudnesses that the
      color scale covers.
      <BR>
      '<B>b</B>' increases the dynamic range by 6dB (by 1dB if <B>Ctrl</B> is held),
      brightening the darker areas to reveal detail;
      <BR>
      '<B>d</B>' decreases the dynamic range by 6dB (by 1dB if <B>Ctrl</B> is held),
      darkening the graphic to hide background noise and
      make the main sonic events stand out.
      <BR>
      The loudest moments in any piece are always shown at maximum brightness
      (usually white) and by changing the dynamic range, you change which
      sound energy value is represented by the dimmest visible color
      (usually dark blue).
      <BR>
      By default, the dynamic range starts at 96dB and the minimum it goes
      down to is 1 decibel, which shows only the very loudest areas.
      <BR>
      You can also set the initial dynamic range with the <B>-d</B>
      command line argument.
 <DT><B>f F</B>
  <DD>These keys change the size of tha audio sample used to calculate each
      column of the spectrogram.
      <BR>
      '<B>f</B>' halves it, improving the graph's time resolution but losing focus
      in the frequency direction, while
      '<B>F</B>' doubles it, which smears time but increases the frequency resolution.
      <BR>
      The starting value is 1/5th of a second,
      which resolves frequencies with a resolution of 5Hz
      and shows about five distinct musical events per second.
      <BR>You can also set the initial FFT frequency with the <B>-f</B> option.
 <DT><B>R K H N M B L D</B>
  <DD>These keys, when pressed with <B>Shift</B> held, select
      the pre-FFT convolution function to a Rectangular, Kaiser,
      Nuttall, Hann, Hamming, Bartlett, Blackman or Dolph (the default) window,
      There is a corresponding command-line option <B>-W</B>.
 <DT><B>w</B>
  <DD>The '<B>w</B>' and '<B>W</B>' keys cycle forward/backwards
      through the eight window functions in the order shown above.
 <DT><B>o</B>
  <DD>The '<B>o</B>' key outputs a copy of the current screen into a PNG file
      and prints the name of the file that it generated.
 <DT><B>t</B>
  <DD>The '<B>t</B>' key shows the current playing time on stdout.
 <DT><B>p</B>
  <DD>Prints the current audio and user interface setting on stdout.
 <DT><B>Ctrl-L</B>
  <DD>Control-L redraws the display from the FFT result cache.
 <DT><B>Ctrl-R</B>
  <DD>Control-R redraws the display, first throwing away all cached FFT results
      so it is recalculated from the audio data.
</DL>

<H3>Frequency markers</H3>

Spettro can overlay the graphic with various sets of horizontal lines:
piano keys, staff lines and guitar strings.

<DL>
 <DT><B>k</B>
  <DD>The '<B>k</B>' key (or the <B>-k</B> command-line flag)
      overlays the spectrogram with 88 horizontal lines,
      some black, some white, showing the frequencies of the keys
      of a grand piano from A0(27.5Hz) to C8(4186Hz).
      <BR>Pressing '<B>k</B>' again removes the keyboard overlay.
 <DT><B>s</B>
  <DD>The '<B>s</B>' key (or the <B>-s</B> command-line flag)
      overlays two five-line pentagrams, as used in
      manuscript, making it look more like a conventional musical score.
      <BR>From top to bottom, the score lines are centered on:
      <BR>F5(698.5Hz) D5(587.3Hz) B4(493.9Hz) G4(392.0Hz) E4(329.6Hz)
      <BR>A3(220.0Hz) F3(174.6Hz) D3(146.8Hz) B2(123.5Hz) G2(98.0Hz)
      <BR>Pressing '<B>s</B>' again removes the score lines.
 <DT><B>g</B>
  <DD>The '<B>g</B>' key (or the <B>-g</B> command-line flag)
      overlays the frequencies of the six strings
      of the classical guitar, centered on:
      <BR>E2(82.4Hz) A2(110Hz) D3(146.8Hz) G3(196.0Hz) B3(246.9Hz) E4 (329.6Hz)
      <BR>Pressing '<B>g</B>' again removes them.
 <DT><B>a</B>
  <DD>The '<B>a</B>' key toggles a frequency axis on the left side of the graph.
</DL>
While piano key lines are one pixel thick, staff lines and guitar lines
are both three pixels thick.
<P>
Only one of Staff and Guitar lines displays at a time (because they overlap)
but you can display the piano keys together with either of them
to identify notes above the top score line or to see the fretted
positions of the guitar strings.

<H3>Bar line indicators</H3>

To help you pick out the rhythm, you can overlay evenly-spaced vertical white
lines onto the graphic to show where each bar (or beat) begins.
<P>
To do this, you mark two pixel columns to say where some bar
starts and ends.
When you set the first of the two bar line markers, a single vertical
line appears at that position you marked and when you set the other one,
bar lines appear at that position and evenly spaced throughout the piece.
<P>
There are three ways to mark the bar line positions:
<UL>
 <LI>The command-line flags <B>-l</B> and <B>-r</B> set the left and right
     bar line position, measured in seconds from the start of the piece.
 <LI>You can position the graphic so that the green line is at the start of a
     bar, press '<B>l</B>', move it to the end of the bar and press '<B>r</B>'.
     For more precise positioning, zoom in on the time axis with '<B>X</B>',
     hold down the <B>Ctrl</B> key and use the left and right arrow keys to
     shift the graphic by one pixel at a time.
 <LI>If you hold down Control, you can position the left bar line by clicking
     the left mouse button and the right bar line by clicking the right button.
</UL>
You can also set the "left" marker to the right of the "right" marker
and it still works.
<P>
Once you have both bar line markers set, you can use the number keys from 1 to 8
to show none or from two to eight beats in each bar. The F1 to F12 keys do the
same, in case you are analysing a piece with eleven beats to the bar.

<H3>System control</H3>

<DL>
 <DT><B>Esc Ctrl-C Q Ctrl-Q</B>
  <DD>These all make spettro quit.
 <DT><B>Ctrl-L</B> / <B>Ctrl-R</B>
  <DD><B>Ctrl-L</B> redraws the graphic display from the results already computed
      while <B>Ctrl-R</B> also recalculates every column.
      These can be useful if the display becomes garbled for some reason.
 <DT><B>Ctrl-F</B>
  <DD>Toggles fullscreen mode.
 <DT><B>t</B>
  <DD>Prints the current playing time on stdout.
 <DT><B>p</B>
  <DD>Prints the current user-interface settings on stdout.
 <DT><B>9 0</B>
  <DD>Spettro has a soft volume control allowing you to increase the volume
      above 100%, like mplayer and VLC, except that spettro's has no maximum
      and it reduces the volume automatically if it would have made the
      audio output clip.
</DL>

<H2>Startup options</H2>

On spettro's command line you can supply various option flags before the
audio file name:
<DL>
 <DT><B>-p</B> / <B>--autoplay</B>
  <DD>Starts playing the audio file as soon as the program starts up.
 <DT><B>-e</B> / <B>--exit-at-end</B>
  <DD>Exits when the audio file has finished playing.
 <DT><B>-w</B> <I>n</I> / <B>--width</B> <I>n</I>
  <DD>Sets the displayed window's width to <I>n</I> pixels.
      This determines (along with --ppsec or the x and X horizontal zoom keys)
      the amount of time that is visible.
      The default width is 640. The maximum with SDL2 seems to be 4090.
 <DT><B>-h</B> <I>n</I> / <B>--height</B> <I>n</I>
  <DD>Sets the displayed window's height to <I>n</I> pixels.
      The default is 480 and the maximum when built with SDL2 seems to be 4064.
 <DT><B>-F</B> / <B>--fullscreen</B>
  <DD>Starts up in full-screen mode.
      The spectrogram is calculated at the width and height given above,
      then scaled to the size of the screen. If you want it pixel-per-pixel
      you also need use -w and -h to specify the screen's width and height.
      The command "xrandr" will tell you these.
 <DT><B>-o</B> <I>filename.png</I>
  <DD>Starts up, calculates the visible part of the spectrogram and dumps it
      into the named file, then exits. With this and -w 4000 -h 1000 you can
      obtain high-quality images to print.
 <DT><B>-j</B> <I>n</I> / <B>--jobs</B> <I>n</I>
  <DD>Sets the number of FFT calculation threads
      (default: the same as the number of CPUs.)
 <DT><B>-t</B> <I>x</I> / <B>--start-at</B> <I>x</I>
  <DD>Starts playing at <I>x</I> seconds into the audio file.
      <I>x</I> is a floating-point number.
 <DT><B>-n</B> f / <B>--min-freq</B> <I>f</I>
  <DD>Sets the frequency centered on the bottom pixel row, default 27.5Hz (A0)\n\
 <DT><B>-x</B> f / <B>--max-freq</B> <I>f</I>
  <DD>Sets the frequency centered on the top pixel row, default 14080Hz (A9)\n\
 <DT><B>--heatmap</B> / <B>--gray</B> / <B>--print</B>
  <DD>Selects the palette as a colored heatmap from blue through red and yellow
      to white, in shades of gray as white on black (for screens)
      or in shades of gray as black on white (for printers.)
 <DT><B>-d</B> n / <B>--dyn-range</B> <I>n</I>
  <DD>Sets the dynamic range of the color map. Default: 100dB.
 <DT><B>-f</B> n / <B>--fft-freq</B> <I>n</I>
  <DD>Sets the FFT frequency in Hz. Default: 5 (using samples of one fifth of a second.)
 <DT><B>-S</B> n / <B>--fps</B> <I>n</I>
  <DD>Scrolls the graphic <I>n</I> times per second.
      Default: 25 frames per second.
 <DT><B>-P</B> n / <B>--ppsec</B> <I>n</I>
  <DD>Displays <I>n</I> pixel columns per second, default: 25.
 <DT><B>-a</B> / <B>--show-axes</B>
  <DD>Shows a frequency scale in Hz on the left side of the graph
      and the note names on the right.
  <DT><B>-W</B> <I>which</I> / <B>--window</B> <I>which</I>
  <DD>Selects the convolution function to apply to audio fragments
      before feeding them to the frequency analysis function, one of:
    <DL>
     <DT><B>-WR</B> / <B>--rectangular</B>
       <DD>Rectangular. The sample's edges are not trimmed, resulting in
	floral artifacts in the spectrogram, most easily seen at
	high magnification.
	It is the fastest of the window functions because it does nothing.
     <DT><B>-WK</B> / <B>--kaiser</B>
      <DD>Kaiser window, "sndile-spectrogram"'s default.
     <DT><B>-WN</B> / <B>--nuttall</B>
      <DD>Nuttall window
     <DT><B>-WH</B> / <B>--hann</B>
      <DD>Hann (a.k.a. "Hanning") window, "sox spectrogram"'s default.
     <DT><B>-WM</B> / <B>--hamming</B>
      <DD>Hamming window
     <DT><B>-WB</B> / <B>--bartlett</B>
      <DD>Bartlett window
     <DT><B>-WL</B> / <B>--blackman</B>
      <DD>Blackman window
     <DT><B>-WD</B> / <B>--dolph</B>
      <DD>Dolph window, our default, giving the best slot filter in the
          frequency domain.
    </DL>
    There are corresponding keystroke commands
    <B>R</B>, <B>K</B>, <B>N</B>, <B>H</B>,
    <B>N</B>, <B>B</B>, <B>L</B> and <B>D</B>,
    the '<B>w</B>' and '<B>W</B>' keys cycle forwards or backwards
    through the eight window functions.
    <P>
    For more info on the different window functions' peculiarities and merits,
    see <A HREF="http://en.wikipedia.org/wiki/Window_function">http://en.wikipedia.org/wiki/Window_function</A>
    or experiment with <B>spettro</B> and see for yourself :)
 <DT><B>-k</B> / <B>--piano</B>
  <DD>Overlays black and green lines showing where 88-note piano's black and white keys are.
 <DT><B>-s</B> / <B>--score</B>
  <DD>Overlays conventional score notation's five-line staves.
 <DT><B>-g</B> / <B>--guitar</B>
  <DD>Overlays lines showing the positions of a classical guitar's strings.
 <DT><B>-v</B> <I>N</I> / <B>--softvol</B> <I>N</I>
  <DD>Sets the softvolume level to <I>N</I>
      (>1.0 is louder than 100%, <1.0 softer)\n\
 <DT><B>--help</B>
  <DD>Shows a summary of all option flags and keys.
</DL>
If no filename is supplied, it opens "audio.wav".

<HR>
Martin Guy &lt;martinwguy&#64;gmail.com>, August-December 2018.
</BODY>
</HTML>
